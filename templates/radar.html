{% extends 'base.html' %}
{% load dict_extras %}

{% block extra_css %}
<style>
    .main-wrap {
        max-width: 1150px;
        margin: 38px auto 0;
        background: #fff;
        border-radius: 18px;
        box-shadow: 0 4px 22px #c1d1e7a3;
        padding: 36px 36px 46px;
        display: flex;
        gap: 44px;
        min-height: 620px;
    }
    .radar-panel {
        min-width: 650px; width: 650px;
        display: flex; flex-direction: column; align-items: center;
        justify-content: center;
        padding: 10px;
    }
    .radar-panel h2 {
        margin: 0 0 12px;
        color: #2a377c;
        font-weight: 600;
        font-size: 1.21rem;
        letter-spacing: 1px;
        text-align: center;
    }
    .info-panel {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        margin-top: 24px;
        min-width: 0;
    }
    .info-title {
        font-size: 1.38rem;
        color: #1e3051;
        font-weight: 700;
        margin-bottom: 5px;
        letter-spacing: 0.5px;
    }
    .info-score {
        font-size: 1.07rem; color: #1b8b6a;
        margin-bottom: 14px; font-weight: 600;
    }
    .info-summary {
        font-size: 1rem;
        color: #4a5271;
        margin-bottom: 22px;
        line-height: 1.63;
        max-width: 470px;
    }
    .info-checklist {
        background: #e8f7ee;
        border-left: 4px solid #2ab070;
        color: #297c43;
        margin-bottom: 18px;
        padding: 12px 18px 12px 15px;
        font-size: 1rem;
        border-radius: 7px;
        display: flex;
        align-items: flex-start;
        gap: 9px;
        max-width: 450px;
    }
    .info-checkmark { font-size: 1.33em; line-height: 1; }
    .recommendation-item {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        color: #856404;
        margin-bottom: 12px;
        padding: 12px 18px 12px 15px;
        font-size: 0.95rem;
        border-radius: 7px;
        max-width: 450px;
    }
    .recommendation-title {
        font-weight: 600;
        margin-bottom: 6px;
        color: #664d03;
    }
    .stage-info {
        background: #e3f2fd;
        border-left: 4px solid #2196f3;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 7px;
    }
    .stage-info h4 {
        margin: 0 0 8px 0;
        color: #1565c0;
        font-size: 1.1rem;
    }
    .stage-badge {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 600;
        text-transform: uppercase;
    }
    .stage-nascent { background: #eda5b0; color: #D32F2F; }
    .stage-emerging { background: #f1d6ac; color: #ef6c00; }
    .stage-scaling { background: #e9b2f1; color: #7b1fa2; }
    .stage-transforming { background: #95d1ed; color: #0277bd; }
    .stage-leading { background: #b9ecb9; color: #2e7d32 ; } 

    /* .stage-nascent { background: #fbeaea; color: #b05656; }
    .stage-emerging { background: #ffe0b2; color: #fb8c00; }
    .stage-scaling { background: #cce4f6; color: #0288d1; }
    .stage-transforming { background: #c8e6c9; color: #2e7d32; }
    .stage-leading { background: #bbdefb; color: #0277bd; }  

    .stage-nascent { background: #f44336; color: #ffffff; }
    .stage-emerging { background: #ff9800; color: #ffffff; }
    .stage-scaling { background: #ffeb3b; color: #000000; }
    .stage-transforming { background: #aed581; color: #33691e; }
    .stage-leading { background: #4caf50; color: #ffffff; }  */


    .score-range {
        font-size: 0.9rem;
        color: #424242;
        margin-top: 5px;
    }
    .stages-container {
        margin-top: 15px;
    }
    .stage-item {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        margin-bottom: 12px;
        overflow: hidden;
    }
    .stage-item.current-stage {
        border-color: #2196f3;
        box-shadow: 0 2px 8px rgba(33, 150, 243, 0.2);
    }
    .stage-header {
        background: #f5f5f5;
        padding: 10px 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .current-stage .stage-header {
        background: #e3f2fd;
    }
    .stage-header h5 {
        margin: 0;
        font-size: 1rem;
        color: #333;
    }
    .stage-range {
        font-size: 0.85rem;
        color: #666;
        font-weight: 500;
    }
    .stage-content {
        padding: 15px;
        background: white;
    }
    .stage-content p {
        margin: 0 0 10px 0;
        line-height: 1.5;
        font-size: 0.9rem;
    }
    .stage-content p:last-child {
        margin-bottom: 0;
    }
    .core-message-info {
        background: #f0f9ff;
        border-left: 4px solid #0ea5e9;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 7px;
    }
    .core-message-info h4 {
        margin: 0 0 10px 0;
        color: #0369a1;
        font-size: 1.1rem;
        font-weight: 600;
    }
    .core-message-content {
        font-size: 1rem;
        color: #1e40af;
        font-weight: 500;
        line-height: 1.5;
        font-style: italic;
    }
    .action-buttons {
        text-align: center;
        margin-top: 32px;
        padding: 0 36px;
    }
    .action-buttons a {
        display: inline-block;
        padding: 12px 24px;
        margin: 0 8px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 500;
        transition: all 0.2s ease;
    }
    .btn-secondary {
        background-color: #6c757d;
        color: white;
    }
    .btn-secondary:hover {
        background-color: #5a6268;
    }
    .btn-primary {
        background-color: #007bff;
        color: white;
    }
    .btn-primary:hover {
        background-color: #0056b3;
    }
    @media (max-width:1400px) {
        .radar-panel { min-width: 600px; width: 600px; }
    }
    
    @media (max-width:1200px) {
        .radar-panel { min-width: 550px; width: 550px; }
    }
    
    @media (max-width:1000px) {
        .main-wrap { flex-direction: column; align-items: stretch; padding: 26px 9px 36px; }
        .radar-panel { width: 100%; min-width: 0; }
    }
    /* Custom styles for clickable radar labels */
    .radar-panel canvas {
        cursor: pointer;
    }
    
    @media (max-width:670px) {
        .main-wrap { padding: 10px 2px 10px; }
        .radar-panel h2 { font-size: 1rem; }
        .info-title { font-size: 1.08rem; }
        .radar-panel { padding-top: 0; min-width: 350px; width: 350px; }
    }
</style>
{% endblock %}

{% block content %}
<div class="bg-gray-50 py-10">
    <div class="main-wrap">
        <div class="radar-panel">
            <h2>AI Maturity Dimensions</h2>
            <div style="height: 550px; width: 100%;">
                <canvas id="radarChart"></canvas>
            </div>
        </div>
        <div class="info-panel" id="info-panel">
            <div class="info-title" id="info-title">Select a dimension</div>
            <div class="info-score" id="info-score">Click on any radar dimension to see details</div>
            <div class="info-summary" id="info-summary">
                Click on any dimension on the radar chart to view detailed recommendations and insights for that category.
            </div>
            <div id="info-recommendations"></div>
        </div>
    </div>
    
    <!-- Personalized Recommendations -->
    <div id="personalized-recommendations" style="max-width: 1150px; margin: 20px auto 0; padding: 0; display: none;">
        <div class="bg-white rounded-xl shadow-sm border p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">ðŸŽ¯ Personalized Recommendations</h3>
            <p class="text-gray-600 mb-6">Based on your response patterns for <span id="selected-dimension-name"></span>, we've identified specific areas where focused action can accelerate your AI maturity.</p>
            
            <div id="recommendations-container" class="space-y-4">
                <!-- Recommendations will be populated by JavaScript -->
            </div>
        </div>
    </div>
    
    <div class="action-buttons">
        <a href="{% url 'results' %}{% if request.GET.session %}?session={{ request.GET.session }}{% endif %}" class="btn-secondary">
            Back to Results
        </a>
        <a href="{% url 'next_steps' %}{% if request.GET.session %}?session={{ request.GET.session }}{% endif %}" class="btn-primary">
            View Next Steps
        </a>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('radarChart').getContext('2d');
    
    const dimensions = {{ categories|safe }};
    // Build scores array ensuring correct mapping
    const scoreMapping = {{ scores.category_scores|safe }};
    const clientScores = dimensions.map(category => scoreMapping[category] || 0);
    
    // Category recommendations from backend - store as array to handle multiple recommendations per dimension
    const allRecommendations = [
        {% if scores.recommendations %}
            {% for rec in scores.recommendations %}
            {
                category: '{{ rec.category|escapejs }}',
                meaning: '{{ rec.meaning|escapejs }}',
                nudge: '{{ rec.nudge|escapejs }}'
            }{% if not forloop.last %},{% endif %}
            {% endfor %}
        {% endif %}
    ];
    
    function showRecommendationsForDimension(dimensionName) {
        const recommendationsContainer = document.getElementById('recommendations-container');
        const recommendationsSection = document.getElementById('personalized-recommendations');
        const selectedDimensionSpan = document.getElementById('selected-dimension-name');
        
        // Filter recommendations for this dimension
        const dimensionRecommendations = allRecommendations.filter(rec => rec.category === dimensionName);
        
        if (dimensionRecommendations.length > 0) {
            // Update the dimension name in the header
            selectedDimensionSpan.textContent = dimensionName;
            
            // Create HTML for all recommendations for this dimension
            let recommendationsHtml = '';
            dimensionRecommendations.forEach(rec => {
                recommendationsHtml += `
                    <div class="bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-lg p-5">
                        <div class="flex items-start">
                            <div class="flex-shrink-0 w-2 h-2 bg-amber-500 rounded-full mt-2 mr-4"></div>
                            <div class="flex-grow">
                                <h4 class="font-medium text-gray-800 mb-2">${rec.category}</h4>
                                <p class="text-sm text-gray-700 mb-3"><strong>Issue:</strong> ${rec.meaning}</p>
                                <p class="text-sm text-blue-700 bg-blue-50 p-3 rounded border-l-4 border-blue-400"><strong>Recommendation:</strong> ${rec.nudge}</p>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            recommendationsContainer.innerHTML = recommendationsHtml;
            recommendationsSection.style.display = 'block';
        } else {
            // Hide the recommendations section if no recommendations for this dimension
            recommendationsSection.style.display = 'none';
        }
    }
    
    // Scoring mechanism for stages
    const scoringMechanism = {
        'Nascent': { min: 5, max: 9, avgMin: 1.0, avgMax: 1.9 },
        'Emerging': { min: 10, max: 12, avgMin: 2.0, avgMax: 2.4 },
        'Scaling': { min: 13, max: 17, avgMin: 2.5, avgMax: 3.4 },
        'Transforming': { min: 18, max: 21, avgMin: 3.5, avgMax: 4.2 },
        'Leading': { min: 22, max: 25, avgMin: 4.3, avgMax: 5.0 }
    };
    
    function getStageFromScore(score) {
        const totalScore = score * 5; // Convert to total points out of 25
        for (const [stage, range] of Object.entries(scoringMechanism)) {
            if (totalScore >= range.min && totalScore <= range.max) {
                return stage;
            }
        }
        return 'Nascent';
    }
    
    function getStageColor(stage) {
        const stageColors = {
            'Nascent': '#D32F2F',
            'Emerging': '#ef6c00', 
            'Scaling': '#7b1fa2',
            'Transforming': '#0277bd',
            'Leading': '#2e7d32'
        };
        return stageColors[stage] || '#eda5b0';
    }
    
    // Stage descriptions for all dimensions
    const stageDescriptions = {
        'AI Vision & Strategic Alignment': {
            'Nascent': { meaning: 'At this stage, AI is almost invisible in the organizationâ€™s strategy. It is absent from formal planning, and no documented vision or blueprint exists to guide its use. Leadership rarely references AI, and when it is mentioned, it carries little weight in decision-making. Any initiatives that do exist are isolated, experimental, and disconnected from business outcomes. Products and services show little to no sign of AI influence, leaving the company without a clear sense of direction for AIâ€™s role in its future. direction.', coreMessage: 'No AI vision, no alignment â€” progress depends on isolated experiments.' },
            'Emerging': { meaning: 'In the emerging stage, AI begins to appear in the strategic conversation, but only in a limited way. Some functions may draft informal visions or start exploring opportunities, yet there is no unified enterprise approach. Leadership still tends to view AI mainly as a tool for automation or efficiency rather than as a driver of transformation. Pilot projects surface across the business, but measurement is weak or nonexistent, making it difficult to tie them to outcomes. AI shows up experimentally in a handful of offerings, signaling curiosity but not yet commitment.', coreMessage: 'Draft vision exists but is siloed and inconsistently applied' },
            'Scaling': { meaning: 'When an organization reaches the scaling stage, AI becomes more explicitly woven into departmental or business-unit strategies. A documented AI vision or blueprint begins to take shape, and some functions are actively validating and adopting it. KPIs are tracked for a select set of high-priority initiatives, giving the company its first glimpse into measurable impact. Leadership increasingly positions AI as an important driver of change, though execution still varies across the enterprise. Some products and services visibly reflect the AI strategy, but adoption remains uneven and pockets of inconsistency persist. remain between businessunits.', coreMessage: 'AI is strategic, but delivery and alignment are uneven' },
            'Transforming': { meaning: 'Enterprise AI strategy is embedded into core business planning. Clear business impact metrics guide prioritization, and AI is viewed as a key lever for transformation across departments', coreMessage: 'AI is embedded in strategy and drives measurable impact across functions' },
            'Leading': { meaning: 'Organizations in the leading stage treat AI not just as part of their strategy, but as a defining element of their long-term positioning. The AI vision is fully institutionalized and guides priorities across every layer of the business. Every AI initiative is linked to measurable business impact, making accountability and value creation transparent. Leadership consistently frames AI as a core enabler of future business models, setting the tone for the entire organization. AI drives innovation pipelines and underpins how products and services are designed, built, and delivered. Companies at this stage are not only advanced internally â€” they also set benchmarks for their industry, shaping how AI transformation is understood and pursued by others.', coreMessage: 'AI vision defines business future â€” fully embedded, measurable, and transformative' }
        },
        'Leadership & Governance': {
            'Nascent': { 
                meaning: 'At the nascent stage, leadership has no unified stance on AI, and any interest that exists is fragmented across individuals. No one in the organization is formally accountable for AI, leaving initiatives to emerge sporadically from isolated teams. Business and technology leaders operate in silos, and decisions about AI are taken ad hoc, often without transparency or consistency. No executive forum or steering committee exists to provide oversight, meaning AI initiatives lack visibility at the top and remain disconnected from enterprise strategy.', 
                coreMessage: 'AI leadership is absent, and initiatives lack direction or oversight.' 
            },
            'Emerging': { 
                meaning: 'In the emerging stage, leadership begins to experiment with AI, often driven by one or two senior leaders who recognize its potential but without a shared vision. Ownership remains fragmented, typically spread across IT or business units, with no clear mandate or authority. Collaboration between business and technology leaders occurs occasionally but only in the context of specific projects, not as a systematic practice. Governance starts to appear in the form of loose guidelines, though they are inconsistently applied. Discussions about AI may surface during budget cycles, but oversight is sporadic and not formalized into structured forums.', 
                coreMessage: 'AI leadership interest exists, but ownership and governance remain fragmented.' 
            },
            'Scaling': { 
                meaning: 'At the scaling stage, leadership moves from experimentation to structured oversight. Executive sponsors not only champion AI but also begin to allocate meaningful budgets aligned with business goals. Governance processes are formalized, with cadence meetings, approval workflows, and accountability mechanisms in place. AI projects are prioritized through a portfolio lens, ensuring alignment with both value potential and risk management. Leaders demand measurable outcomes, linking initiatives to key performance indicators. While execution is improving, the challenge lies in ensuring that governance keeps pace with the growing volume and complexity of AI projects.', 
                coreMessage: 'AI leadership structures are forming, but authority and influence are still limited.' 
            },
            'Transforming': { 
                meaning: 'In the transforming stage, leadership fully integrates AI into strategic planning and enterprise governance. AI is no longer treated as an add-on but as a critical enabler of transformation, with sponsorship anchored at the C-suite level and often championed directly by the CEO. Decision-making becomes evidence-driven, supported by dashboards and performance reviews that track AIâ€™s contribution to outcomes such as growth, efficiency, and risk reduction. Governance frameworks are mature, balancing innovation with compliance, ethics, and security. Leaders foster cross-functional collaboration, ensuring that accountability for AI outcomes extends beyond IT or data teams and becomes a shared responsibility across the business.', 
                coreMessage: 'AI is championed at the top, with formal governance and shared accountability across the business.' 
            },
            'Leading': { 
                meaning: 'At the leading stage, AI governance becomes a hallmark of organizational leadership excellence. The board and C-suite treat AI as a core driver of competitive advantage and ensure that governance is adaptive, transparent, and forward-looking. Leadership not only provides strong sponsorship but also sets clear ethical guardrails and risk frameworks, influencing industry norms and sometimes shaping regulatory conversations. Governance structures evolve into an operating rhythm that enables agility without sacrificing accountability. Leaders act as role models, linking AI-driven transformation directly to the companyâ€™s purpose, culture, and stakeholder trust. At this level, leadership and governance shift from enabling adoption to sustaining an AI-first organization.', 
                coreMessage: 'AI leadership is institutionalized, with board-level oversight and governance as a competitive advantage.' 
            }
        },
        'Use Case Portfolio & Prioritization': {
            'Nascent': {
                meaning: 'At this stage, AI use cases are nonexistent or limited to isolated, exploratory pilots. There is no formal prioritization framework, and initiatives are chosen based on enthusiasm or ad hoc needs rather than strategic alignment. Metrics and KPIs are absent, meaning there is no way to measure outcomes or value. Pilots rarely, if ever, progress into production. No playbooks or reusable templates exist, so even learnings from early experiments are not institutionalized.',
                coreMessage: 'AI adoption is absent or scattered â€” no prioritization, no measurement, no scale.'
            },
            'Emerging': {
                meaning: 'AI pilots start to appear in select business units, often driven by individual leaders or technology teams. Some level of prioritization emerges, usually based on urgency or ROI, but it lacks consistency and strategic direction. Basic output metrics (like model accuracy) may be tracked, but these are not connected to business outcomes. A handful of pilots progress to limited use, but most stall at proof-of-concept. Teams may experiment with templates or reusable assets, but they are fragmented and inconsistent.',
                coreMessage: 'Pilots exist, but prioritization and metrics are inconsistent â€” adoption remains experimental.'
            },
            'Scaling': {
                meaning: 'Organizations begin to formalize how use cases are selected, often evaluating them against business value, feasibility, and risk. High-priority pilots are linked to defined success metrics, and more projects progress into production. While success is uneven, some clear wins demonstrate tangible value. Playbooks or templates start to emerge for repeatable use cases, though they are not universally applied. The organization is learning how to scale, but adoption remains uneven across departments.',
                coreMessage: 'Prioritization is structured and pilots are scaling, though inconsistently.'
            },
            'Transforming': {
                meaning: 'Use case portfolio management becomes systematic and enterprise-wide. A standardized prioritization model is consistently applied, ensuring that AI investments align with business strategy and risk appetite. The majority of AI initiatives are linked to measurable KPIs, and pilots regularly transition into production with proven impact. Playbooks and reusable assets are widely used, accelerating time-to-value. AI is no longer experimental â€” it is embedded into workflows and decision-making across functions.',
                coreMessage: 'AI portfolio is strategically prioritized, KPI-driven, and delivering measurable business value.'
            },
            'Leading': {
                meaning: 'At the leading stage, AI use case portfolio management is industrialized and continuously refreshed. Every initiative is prioritized against a unified, enterprise-wide framework that balances value, feasibility, and risk. KPIs are embedded into all initiatives, and pilots have a consistently high conversion rate into scalable, production-ready systems. A robust library of playbooks, templates, and accelerators institutionalizes best practices, making adoption repeatable and fast. The organization not only executes effectively but also shapes industry benchmarks, using its AI portfolio as a competitive differentiator.',
                coreMessage: 'AI portfolio is industrialized â€” repeatable, scalable, and transformative at enterprise scale.'
            }
        },

        'Data Infrastructure & Quality': {
            'Nascent': {
                meaning: 'Data is fragmented, siloed, and often unreliable. Teams struggle to locate or access usable data, and no catalog or inventory exists. Quality is not validated, and legacy systems hinder AI workloads. Integration between sources is nonexistent, meaning AI initiatives are blocked at the starting line.',
                coreMessage: 'Fragmented, inaccessible, low-quality data blocks AI progress.'
            },
            'Emerging': {
                meaning: 'Basic efforts begin to address data foundations. A pilot catalog or limited inventories may exist, but they are isolated to certain domains. Ad hoc integrations are built when needed, but they are fragile and inconsistent. Data warehouses or basic cleaning is underway, but scalability remains limited. Quality validation starts for select datasets, though confidence across teams remains low. AI can move past pure experimentation, but foundations are still shaky.',
                coreMessage: 'Early data foundations exist, but integration and quality are inconsistent.'
            },
            'Scaling': {
                meaning: 'Data accessibility improves through unified platforms that make curated data available across multiple functions. A searchable catalog exists for much of the enterprise, improving visibility. Systematic pipelines begin to integrate internal and external data sources, creating broader coverage. Infrastructure is reliable enough to support key AI projects, and governance frameworks for data begin to formalize. Quality checks are applied at scale, though not yet fully automated.',
                coreMessage: 'Integrated data platforms and governance support expanding AI use.'
            },
            'Transforming': {
                meaning: 'Data is treated as a managed enterprise asset. Real-time, governed, and on-demand access is available to most teams, and a dynamic catalog ensures discoverability and usability. Integration pipelines unify data across the business, and infrastructure is enterprise-grade with elasticity to support large-scale AI workloads. Quality checks and lineage are embedded into processes, ensuring trust in AI outputs. Teams can experiment, scale, and deploy AI quickly without being slowed by data issues.',
                coreMessage: 'Enterprise-ready, governed data foundation powers transformation.'
            },
            'Leading': {
                meaning: 'At this stage, the organization achieves a fully industrialized, intelligent data ecosystem. Data is proactively managed, continuously updated, and instantly available enterprise-wide. Catalogs are dynamic and AI-assisted, guiding discoverability and compliance in real time. Integration is seamless, spanning multi-cloud and external ecosystems. Infrastructure is AI-first â€” cloud-native, automated, and self-optimizing â€” designed to power advanced AI (e.g., generative AI, real-time personalization) at scale. Data quality is continuously monitored and improved, ensuring trust across every AI initiative.',
                coreMessage: 'Intelligent, AI-first data ecosystem drives enterprise-wide scale and industry leadership.'
            }
        },
        'Talent & Culture': {
            'Nascent': {
                meaning: 'The organization has no meaningful AI/ML expertise in-house, and business teams lack awareness or training. Collaboration between business and technical teams is minimal or nonexistent, with work handled in silos. There is no defined operating model for AI, and roles are unclear. The culture is risk-averse, discouraging experimentation or innovation. AI remains theoretical with no organizational readiness to support it.',
                coreMessage: 'No AI talent, no skills, no culture â€” readiness is near zero.'
            },
            'Emerging': {
                meaning: 'Early steps are taken to introduce AI talent and cultural awareness. One or two specialists or analysts may exist, and sporadic awareness sessions help expose business teams to AI concepts. Collaboration happens occasionally but is transactional rather than strategic. Role clarity is weak, with AI work often assigned ad hoc. Cultural openness to AI is limited, with experimentation happening only in isolated pockets. AI projects exist, but people and processes are not yet aligned.',
                coreMessage: 'Initial AI skills and awareness exist, but adoption is fragmented and cultural buy-in is weak.'
            },
            'Scaling': {
                meaning: 'Dedicated AI/ML teams begin to form, supporting a growing number of use cases across the business. Select teams are being upskilled with use-case-specific training, and collaboration between business and technical groups improves through joint planning. Role clarity is emerging, with defined responsibilities in some departments. Cultural openness to experimentation is growing, with some teams encouraged to test AI ideas. The foundation for AI readiness is visible but inconsistent across the enterprise.',
                coreMessage: 'AI skills and collaboration are growing, but maturity is uneven across the organization.'
            },
            'Transforming': {
                meaning: 'Cross-functional AI/ML specialists are embedded across departments, enabling broad collaboration. Business teams benefit from ongoing learning programs, and AI literacy is becoming part of the organizational fabric. Operating models are formalized, with clear roles and responsibilities across product, data, and technical teams. A culture of experimentation is promoted, especially in innovation units, allowing safe-to-fail pilots. AI readiness is no longer a bottleneck â€” people, skills, and structures enable transformation.',
                coreMessage: 'Skilled teams, structured roles, and cultural readiness drive enterprise AI transformation.'
            },
            'Leading': {
                meaning: 'AI talent and skills are deeply institutionalized across both business and technical units. Continuous, enterprise-wide AI literacy programs empower all employees to use and co-create AI solutions. Collaboration is seamless, with cross-functional teams co-owning and scaling AI initiatives. Operating models are enterprise-wide, clearly defining accountability, delivery, and governance for AI. The culture rewards a growth mindset and test-and-learn approaches, making experimentation and adaptation a core strength. The organization is not just AI-ready â€” it sets benchmarks for talent and cultural alignment in its industry.',
                coreMessage: 'AI talent, skills, and culture are institutionalized â€” enabling sustained, enterprise-wide innovation.'
            }
        },
        'Responsible AI & Risk': {
            'Nascent': {
                meaning: 'The organization has no formal Responsible AI policies or frameworks in place. AI models are deployed without checks for bias, fairness, or unintended consequences, and no oversight processes exist. There is no accountability when AI-driven decisions impact users or stakeholders. Risks such as drift, misuse, or compliance failures are only recognized after issues arise. At this stage, AI may be used, but it operates without safeguards, exposing the organization to ethical, reputational, and regulatory risks.',
                coreMessage: 'No guardrails â€” AI is unmanaged, unaccountable, and high-risk.'
            },
            'Emerging': {
                meaning: 'Early conversations about Responsible AI begin, but practices remain inconsistent. Draft guidelines may be in progress, and basic fairness checks are applied in limited projects. Oversight is informal, with deployment decisions left to individual project teams or leaders. Accountability for AI decisions is reactive, usually addressed only when problems surface. Risk management practices are ad hoc, and monitoring is limited to isolated pilots. The intent to act responsibly exists, but it has not yet been institutionalized.',
                coreMessage: 'Awareness is growing, but Responsible AI is patchy and reactive.'
            },
            'Scaling': {
                meaning: 'Responsible AI starts to take shape through formalized but uneven practices. A policy framework may be approved, and fairness testing occurs in select high-risk projects. Oversight exists for critical models, often through designated leaders or committees. Accountability mechanisms for AI decisions are clearer, though not yet enterprise-wide. Some projects include risk assessments and mitigation plans, supported by partial monitoring tools. Responsible AI practices are gaining traction but lack full coverage.',
                coreMessage: 'Policies and controls are emerging, but not consistently applied across AI.'
            },
            'Transforming': {
                meaning: 'Responsible AI becomes a structured part of governance. Policies and ethical principles are codified, embedded into workflows, and communicated enterprise-wide. Bias, fairness, and unintended consequence testing are applied across most initiatives. Oversight is cross-functional, with governance processes for high-impact and regulated models. Accountability is built into governance structures, with clear escalation paths when AI impacts users. Risk monitoring tools track performance, drift, and compliance systematically. Responsible AI moves from theory to practice, reducing organizational exposure.',
                coreMessage: 'Responsible AI is structured, governed, and embedded into delivery.'
            },
            'Leading': {
                meaning: 'Responsible AI is institutionalized and sets benchmarks for the industry. Policies are deeply embedded into design, development, and deployment, with automation supporting fairness, bias, and risk testing across the lifecycle. Formal governance boards oversee all models, with clear accountability at every level. AI-driven decisions are proactively explained, transparent, and aligned with user trust and ethical standards. Model risk management is enterprise-wide, proactive, and compliance-aligned, ensuring early detection and mitigation of drift, misuse, or performance failures. The organization demonstrates leadership in ethical AI, often shaping industry norms and regulatory best practices.',
                coreMessage: 'Responsible AI is proactive, standardized, and sets the benchmark for trust and safety.'
            }
        },
        'Measurement, Scaling & ROI': {
            'Nascent': {
                meaning: 'At this stage, AI initiatives are launched without any formal measurement of impact. ROI is not tracked, and there is no clear link between AI and business outcomes such as cost savings, growth, or CX. No dashboards exist, making adoption and performance invisible to leadership. Failures are ignored, with no effort to extract lessons. Successful pilots, if any, are not scaled beyond isolated experiments. AI efforts remain tactical and disconnected from enterprise value.',
                coreMessage: 'No measurement, no learning, no scale.'
            },
            'Emerging': {
                meaning: 'Early attempts are made to measure AI impact, but practices are inconsistent. Success is often gauged qualitatively or through anecdotal wins. ROI is sometimes estimated after pilots, but not standardized. Tracking is manual, handled within teams, and limited to isolated models. Failures may trigger informal reflections, but insights rarely shape future efforts. A few pilots are converted into internal guides, but no formal scaling approach exists. AI projects begin to show promise but remain opportunistic.',
                coreMessage: 'Early signs of impact, but measurement and scaling are fragmented.'
            },
            'Scaling': {
                meaning: 'AI initiatives increasingly link to measurable outcomes, with some use cases reporting ROI aligned to KPIs. Dashboards exist for critical models or departments, giving partial visibility into performance and adoption. Post-mortems are held for select pilots, and insights are documented more systematically. Some scaling playbooks emerge, helping replicate successful projects, though adoption is uneven across the enterprise. At this stage, AI value is visible, but governance and measurement are not yet universal.',
                coreMessage: 'ROI and outcomes are visible, but scaling and governance are inconsistent.'
            },
            'Transforming': {
                meaning: 'ROI measurement is standardized and embedded into most AI initiatives, tied directly to business KPIs. Nearly all projects report against strategic outcomes like growth, cost, CX, or sustainability. Dashboards track performance and adoption across functions, enabling leadership oversight. Lessons from failed initiatives are documented, shared, and actively used to shape future project design and governance. Scaling is systematic, supported by playbooks and SOPs that accelerate reuse and rollout. AI becomes a managed portfolio of initiatives with proven business value.',
                coreMessage: 'AI value is measurable, repeatable, and informs enterprise-wide scaling.'
            },
            'Leading': {
                meaning: 'At the leading stage, AI impact measurement is institutionalized across the organization. Every initiative is mapped to one or more strategic vectors and tracked through a standardized ROI framework. Executive-level scorecards provide real-time visibility into adoption, maturity, and value creation. Failures are not just reviewed â€” they systematically feed back into governance and design, making AI efforts continuously self-improving. Scaling is enterprise-wide, supported by a robust framework that ensures reuse, rollout, and integration across functions. AI investment decisions are evidence-driven, maximizing both business value and innovation.',
                coreMessage: 'AI is industrialized â€” measurable, scalable, and continuously improving.'
            }
        },
        'AI Operating Model & Change Readiness': {
            'Nascent': {
                meaning: 'At this stage, the organization has no defined AI operating model. Roles and responsibilities are scattered, and there is no structured approach to delivering value from AI. Change management is absent, with little to no communication around adoption. Business units have no incentives to adopt AI, and there are no champions or advocates promoting its use. Experimentation is minimal or non-existent, with no sandboxes or safe environments for teams to try AI tools. AI efforts remain ad hoc, fragmented, and disconnected from enterprise priorities.',
                coreMessage: 'No structure, no incentives, no readiness for AI adoption.'
            },
            'Emerging': {
                meaning: 'Early steps toward AI adoption begin, but structures remain weak. A central AI or analytics team may exist, but it operates in isolation from the business. Communication around AI adoption is reactive, often triggered only when challenges arise. A few employees act as informal AI ambassadors, but their influence is limited. Some teams may experiment with AI in controlled or technical settings, though access is restricted. Business incentives for adoption are vague or non-existent. Momentum is building, but it is not coordinated or supported enterprise-wide.',
                coreMessage: 'Initial structures and advocates exist, but adoption is fragmented and reactive.'
            },
            'Scaling': {
                meaning: 'A federated operating model begins to emerge, with shared responsibilities between central and business teams. Change management practices improve, with some trainings and awareness programs offered post-rollout. Incentives for adoption start to take shape, such as budget relief or productivity credits for business units using AI. Formal AI champions are named in select functions, helping build awareness and momentum. Sandboxes exist in some departments, allowing limited experimentation. AI adoption is growing, but consistency and alignment across the enterprise remain uneven.',
                coreMessage: 'Shared models, incentives, and experimentation exist, but maturity is uneven.'
            },
            'Transforming': {
                meaning: 'An enterprise operating model is in place, aligning ownership, delivery, and value across functions. Change management is embedded into most AI programs, with proactive communication and enablement. AI adoption is tied to OKRs or KPIs, ensuring business accountability. Champions and change agents are designated across departments, driving awareness and cross-functional collaboration. Open-access sandboxes are available to business teams, promoting innovation and safe experimentation. AI adoption is no longer optional â€” it is becoming systematic and structured.',
                coreMessage: 'AI adoption is structured, incentivized, and supported by culture and tools.'
            },
            'Leading': {
                meaning: 'The organization operates with a fully institutionalized AI operating model, integrating ownership, delivery, and governance across the enterprise. Change management is proactive and built into every AI initiative, ensuring smooth adoption from planning to execution. AI adoption is directly tied to performance metrics and business outcomes, incentivizing scale. A cross-functional enablement team drives enterprise-wide awareness, training, and adoption. Sandboxes are enterprise-funded, governed, and embedded into innovation programs, enabling both technical and business teams to experiment safely. AI adoption is sustained, scalable, and culturally ingrained.',
                coreMessage: 'AI operating model and change readiness are institutionalized â€” enabling sustainable, enterprise-wide adoption.'
            }
        },
        'Technology & AI Infrastructure': {
            'Nascent': {
                meaning: 'The organization lacks AI-ready infrastructure. There are no dedicated environments for model training or deployment, and any AI work depends on ad hoc setups. There are no operational tools, no version control, and no monitoring in place. Real-time or streaming capabilities are absent. AI development is experimental, fragile, and unsustainable at scale.',
                coreMessage: 'No infrastructure â€” AI is experimental and unsustainable.'
            },
            'Emerging': {
                meaning: 'Early infrastructure for AI experimentation begins to appear, such as limited cloud instances or testing environments. Scripts and workflows are managed manually, with little automation. Basic documentation exists for select models, but versioning is inconsistent. Some pipelines support near-real-time use, but they are not scalable. Monitoring is manual and sporadic, providing minimal visibility into model performance. AI efforts are possible but remain fragile and inconsistent.',
                coreMessage: 'Early foundations exist, but practices are ad hoc and fragile.'
            },
            'Scaling': {
                meaning: 'Dedicated servers, cloud instances, and versioning tools support AI initiatives more systematically. MLOps tools are piloted or adopted in parts of the organization, enabling repeatable workflows. Some models are version-controlled, reproducible, and auditable. Limited real-time AI use cases exist in testing or early production. Monitoring dashboards track performance and drift for critical models, though not enterprise-wide. AI infrastructure supports scaling, but practices remain uneven.',
                coreMessage: 'Infrastructure and tools support scaling, but adoption is inconsistent.'
            },
            'Transforming': {
                meaning: 'Infrastructure becomes enterprise-grade, supporting large-scale AI training, deployment, and real-time use cases. MLOps and AIOps platforms are established across departments, automating much of the lifecycle. All models are tracked and reproducible, with audit trails and rollback options. Real-time inference powers multiple business functions, while monitoring systems detect performance changes and drift with partial automation. The stack is reliable, scalable, and capable of driving enterprise-wide AI adoption.',
                coreMessage: 'Enterprise-grade infrastructure operationalizes AI at scale.'
            },
            'Leading': {
                meaning: 'The organization operates with a fully optimized, AI-first technology environment. Infrastructure supports GenAI, multi-model orchestration, and real-time streaming as a default. MLOps pipelines fully automate training, deployment, monitoring, and retraining across the lifecycle. Every model has complete lineage, version history, and rollback capabilities. Real-time inference is standard, powering advanced use cases across industries. Monitoring and drift management are proactive, with automated retraining pipelines. The stack is not just scalable â€” it is adaptive, intelligent, and benchmark-setting.',
                coreMessage: 'AI infrastructure is enterprise-optimized, automated, and industry-leading.'
            }
        }
    };
    
    // Detailed information for each dimension
    const dimensionsData = {
        'AI Vision & Strategic Alignment': {
            title: 'AI Vision & Strategic Alignment',
            summary: 'Understand how clearly your company sees and steers its AI future.',
            // checklist: 'Key areas: Strategic alignment, documented vision, measurable outcomes, realistic roadmaps, and consistent communication across the organization.'
        },
        'Leadership & Governance': {
            title: 'Leadership & Governance',
            summary: 'Understand how well leadership supports, owns, and steers AI efforts.',
            // checklist: 'Key areas: Executive ownership, formal governance, committed funding, structured approvals, and accountability for outcomes.'
        },
        'Use Case Portfolio & Prioritization': {
            title: 'Use Case Portfolio & Prioritization',
            summary: 'Understand how AI is being used and scaled across your organization.',
            // checklist: 'Key areas: Use case identification, pilot execution, production deployment, and business value realization.'
        },
        'Data Infrastructure & Quality': {
            title: 'Data Infrastructure & Quality',
            summary: 'Assess how well the organizationâ€™s data foundations and infrastructure support AI at scale',
            // checklist: 'Key areas: Data quality, accessibility, governance frameworks, and robust analytics infrastructure.'
        },
        'Talent & Culture': {
            title: 'Talent & Culture',
            summary: 'Understand if your teams are skilled, aligned, and culturally ready for AI.',
            // checklist: 'Key areas: Talent acquisition, skill development, training programs, and capability building initiatives.'
        },
        'Responsible AI & Risk': {
            title: 'Responsible AI & Risk',
            summary: 'Understand how responsibly and safely your organization builds and uses AI.',
            // checklist: 'Key areas: Risk assessment, compliance frameworks, governance structures, and responsible AI practices.'
        },
        'Measurement, Scaling & ROI': {
            title: 'Measurement, Scaling & ROI',
            summary: 'Understand how your organization tracks, scales, and learns from AI efforts.',
            // checklist: 'Key areas: Performance metrics, ROI measurement, continuous improvement, and optimization strategies.'
        },
        'AI Operating Model & Change Readiness': {
            title: 'AI Operating Model & Change Readiness',
            summary: 'Understand how your company is set up to support, scale, and sustain AI adoption.',
            // checklist: 'Key areas: Cultural readiness, change management, stakeholder engagement, and transformation initiatives.'
        },
        'Technology & AI Infrastructure': {
            title: 'Technology & AI Infrastructure',
            summary: 'Understand how well your tech stack supports building, running, and scaling AI.',
            // checklist: 'Key areas: Modern technology stack, cloud readiness, MLOps capabilities, and scalable infrastructure.'
        }
    };
    
    function highlightDimension(index) {
        selectedDimensionIndex = index;
        const dataset = radarChart.data.datasets[0];
        
        // Force update all colors - using #001582 for highlighting
        dataset.pointBackgroundColor = [];
        dataset.pointBorderColor = [];
        dataset.pointRadius = [];
        
        for (let i = 0; i < clientScores.length; i++) {
            if (i === index) {
                dataset.pointBackgroundColor[i] = '#001582';
                dataset.pointBorderColor[i] = '#001582';
                dataset.pointRadius[i] = 6;
            } else {
                dataset.pointBackgroundColor[i] = 'rgba(14, 165, 233, 1)';
                dataset.pointBorderColor[i] = '#fff';
                dataset.pointRadius[i] = 4;
            }
        }
        
        radarChart.update('none');
    }
    
    function setInfoPanel(dimensionName) {
        const data = dimensionsData[dimensionName];
        const scoreIndex = dimensions.indexOf(dimensionName);
        const score = scoreIndex >= 0 ? clientScores[scoreIndex] : 0;
        const currentStage = getStageFromScore(score);
        const totalScore = score * 5;
        
        // Highlight the selected dimension
        highlightDimension(scoreIndex);
        
        // Show recommendations for this dimension
        showRecommendationsForDimension(dimensionName);
        
        if (data) {
            document.getElementById('info-title').textContent = data.title;
            document.getElementById('info-score').textContent = `Score: ${score}/5 (${totalScore}/25)`;
            document.getElementById('info-summary').textContent = data.summary;
            
            // Show stage-based guidance
            const recommendationsDiv = document.getElementById('info-recommendations');
            let recommendationsHtml = '';
            
            // Add current stage information
            recommendationsHtml += `
                <div class="stage-info">
                    <h4>Current Stage: <span class="stage-badge stage-${currentStage.toLowerCase()}">${currentStage}</span></h4>
                    <div class="score-range">Score Range: ${scoringMechanism[currentStage].min}-${scoringMechanism[currentStage].max} points (${scoringMechanism[currentStage].avgMin}-${scoringMechanism[currentStage].avgMax} avg per question)</div>
                </div>
            `;
            
            // Show core message in separate box
            const categoryStages = stageDescriptions[dimensionName];
            if (categoryStages && categoryStages[currentStage]) {
                const stageData = categoryStages[currentStage];
                
                // Add meaning in separate section
                recommendationsHtml += `
                    <div class="stage-item current-stage">
                        <div class="stage-content">
                            <p><strong>Meaning:</strong> ${stageData.meaning}</p>
                        </div>
                    </div>
                `;
                                // Add core message box (similar to current stage)
                recommendationsHtml += `
                    <div class="core-message-info">
                        <h4>In short</h4>
                        <div class="core-message-content">${stageData.coreMessage}</div>
                    </div>
                `;
            } else {
                // Fallback to general checklist if no stage descriptions available
                recommendationsHtml += `
                    <div class="info-checklist">
                        <span class="info-checkmark">âœ“</span>
                        <span>${data.checklist}</span>
                    </div>
                `;
            }
            
            recommendationsDiv.innerHTML = recommendationsHtml;
        }
    }
    
    let selectedDimensionIndex = -1;
    
    const radarChart = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: dimensions,
            datasets: [
                {
                    label: '{{ request.session.user_company|default:"Your Score" }}',
                    data: clientScores,
                    backgroundColor: 'rgba(14, 165, 233, 0.2)',
                    borderColor: 'rgba(14, 165, 233, 0.7)',
                    borderWidth: 2,
                    pointBackgroundColor: 'rgba(14, 165, 233, 1)',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#001582',
                    pointHoverBorderColor: '#001582',
                    pointRadius: 4
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                r: {
                    angleLines: {
                        display: true,
                        color: 'rgba(0, 0, 0, 0.1)'
                    },
                    grid: {
                        color: 'rgba(0, 0, 0, 0.1)'
                    },
                    pointLabels: {
                        font: function(context) {
                            return {
                                size: 11,
                                weight: selectedDimensionIndex === context.index ? 'bold' : 'normal'
                            };
                        },
                        color: function(context) {
                            return selectedDimensionIndex === context.index ? '#001582' : '#2563eb';
                        },
                        padding: 1,
                        callback: function(label) {
                            const words = label.split(' ');
                            const lines = [];
                            let currentLine = '';
                            
                            words.forEach(word => {
                                const testLine = currentLine ? currentLine + ' ' + word : word;
                                if (testLine.length > 20) {
                                    if (currentLine) {
                                        lines.push(currentLine);
                                        currentLine = word;
                                    } else {
                                        lines.push(word);
                                    }
                                } else {
                                    currentLine = testLine;
                                }
                            });
                            
                            if (currentLine) {
                                lines.push(currentLine);
                            }
                            
                            return lines;
                        }
                    },
                    // pointLabels: {
                    //     font: { size: 13 },
                    //     color: function(context) {
                    //         return selectedDimensionIndex === context.index ? '#001582' : '#2563eb';
                    //     },
                    //     padding: 25
                    // },
                    ticks: {
                        stepSize: 1,
                        backdropColor: 'transparent',
                        font: { size: 10 },
                        color: '#64748b'
                    },
                    suggestedMin: 0,
                    suggestedMax: 5
                }
            },
            plugins: {
                legend: { display: false },
                tooltip: {
                    callbacks: {
                        labelColor: function(context) {
                            const score = clientScores[context.dataIndex];
                            const stage = getStageFromScore(score);
                            return {
                                backgroundColor: getStageColor(stage),
                                borderColor: getStageColor(stage)
                            };
                        }
                    }
                }
            },
            elements: {
                line: { tension: 0.1 }
            },
            onClick: function(event, elements) {
                // Use Chart.js built-in element detection for more reliable clicking
                if (elements.length > 0) {
                    const index = elements[0].index;
                    const dimensionName = dimensions[index];
                    setInfoPanel(dimensionName);
                    return;
                }
                
                // Handle clicks on dimension labels
                const canvasPosition = Chart.helpers.getRelativePosition(event, radarChart);
                const datasetMeta = radarChart.getDatasetMeta(0);
                const scale = datasetMeta.rScale;
                
                // Check if click is near any label - use correct angle mapping
                for (let i = 0; i < dimensions.length; i++) {
                    // Chart.js radar starts at top (90 degrees) and goes clockwise
                    // We need to map the visual position to the correct dimension index
                    const angle = scale.getIndexAngle(i) - Math.PI / 2; // Adjust for top start
                    const labelRadius = scale.drawingArea + 25;
                    const labelX = scale.xCenter + Math.cos(angle) * labelRadius;
                    const labelY = scale.yCenter + Math.sin(angle) * labelRadius;
                    
                    const distance = Math.sqrt(
                        Math.pow(canvasPosition.x - labelX, 2) + 
                        Math.pow(canvasPosition.y - labelY, 2)
                    );
                    
                    if (distance < 60) { // Increased tolerance for better UX
                        // Use the correct dimension index
                        setInfoPanel(dimensions[i]);
                        return;
                    }
                }
            },
            onHover: function(event, elements) {
                const canvasPosition = Chart.helpers.getRelativePosition(event, radarChart);
                const datasetMeta = radarChart.getDatasetMeta(0);
                const scale = datasetMeta.rScale;
                let isOverLabel = false;
                
                // Check if hovering over any label - use same corrected angle calculation
                for (let i = 0; i < dimensions.length; i++) {
                    const angle = scale.getIndexAngle(i) - Math.PI / 2; // Adjust for top start
                    const labelRadius = scale.drawingArea + 25;
                    const labelX = scale.xCenter + Math.cos(angle) * labelRadius;
                    const labelY = scale.yCenter + Math.sin(angle) * labelRadius;
                    
                    const distance = Math.sqrt(
                        Math.pow(canvasPosition.x - labelX, 2) + 
                        Math.pow(canvasPosition.y - labelY, 2)
                    );
                    
                    if (distance < 60) {
                        isOverLabel = true;
                        break;
                    }
                }
                
                event.native.target.style.cursor = (elements.length > 0 || isOverLabel) ? 'pointer' : 'default';
            }
        }
    });
    
    // Set initial panel to first dimension
    if (dimensions.length > 0) {
        selectedDimensionIndex = -1; // Reset to ensure highlighting works
        setInfoPanel(dimensions[0]);
    }
});
</script>
{% endblock %}